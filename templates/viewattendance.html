{% extends 'base.html' %}
{% block content %}
<style>
    /* Sidebar */
    .sidebar {
        width: 250px;
        background-color: #4B0082;
        height: calc(100% - 40px);
        position: fixed;
        left: -250px;
        top: 65px;
        padding: 20px 0;
        box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        animation: slideIn 0.5s forwards;
    }
    @keyframes slideIn { 
	to { 
			left:0; 
		} 
	}
    .sidebar-header { 
		text-align:center;
		padding-bottom:30px;
		border-bottom:1px 
		solid #333; 
		margin-bottom:20px;
	}
    .sidebar-title { 
		color:#00e676; 
		font-size:24px; 
		margin:0; 
	}
    .sidebar-nav { 
		list-style:none; 
		padding:0;
		margin:0;
	}
    .nav-item { 
		margin-bottom:10px;
	}
    .nav-link { 
		display:block;
		padding:15px 25px; 
		color:#ccc;
		text-decoration:none; 
		font-size:18px; 
		transition: background-color 0.3s ease, color 0.3s ease;
	}
    .nav-link:hover { 
		background-color:#00e676;
		color:#1f1f1f;
	}
    .logout {
		margin-top:40px; 
	}
    .logout .nav-link { 
		background-color:#333; 
		color:#fff; 
		border-radius:5px; 
		text-align:center; 
		margin:0 25px; 
	}
    .logout .nav-link:hover { 
		background-color:#ff4444;
		color:#fff;
	}

    /* Main content */
    main { 
		margin-left:250px; 
		padding:20px; 
		background-color:#f8fafc;
		min-height:500px;
	}

    h1 { 
		font-size:2rem;
		font-weight:bold;
		margin-bottom:20px;
	}

    .date-filter { 
		display:flex; 
		align-items:center;
		gap:5px; 
		margin-bottom:10px;
	}
    .date-filter label { 
		font-size:0.875rem;
		color:#6b7280; 
	}
    .date-filter input[type="date"] { 
		padding:6px 10px; 
		border:1px solid #d1d5db; 
		border-radius:0.375rem; 
	}
    .date-filter button { 
		background-color:#0095f6; 
		color:#fff; 
		font-weight:bold; 
		padding:6px 12px; 
		border:none; 
		border-radius:0.375rem; 
		cursor:pointer; 
		transition:background-color 0.3s; 
	}
    .date-filter button:hover { 
		background-color:#007acc;
	}
    .table-container { 
		background-color:#fff; 
		border-radius:0.5rem; 
		box-shadow:0 1px 3px rgba(0,0,0,0.1); 
		overflow-x:auto; 
		overflow:y;
		max-height: 500px;
	}
    table { 
		width:100%; 
		border-collapse:collapse; 
		font-size:0.875rem; 
	}
	.table-container::-webkit-scrollbar {
		display: none;
	}
	.table-container table thead {
		position: sticky;
		top: 0; 
		background-color: #f3f4f6; 
		z-index: 1;
	}
    thead { 
		background-color:#f3f4f6; 
		text-transform:uppercase; 
		font-size:0.75rem; 
		color:#374151; 
	}
    th, td { 
		padding:12px 20px; 
		border-bottom:1px; 
		solid #e5e7eb; 
		text-align:left; 
	}
    tbody tr:nth-child(even) { 
		background-color:#f9fafb; 
	}

    .no-data { height:12rem; display:flex; justify-content:center; align-items:center; color:#9ca3af; }
		.sidebar-toggle {
		position: absolute;
		top: 20px;
		right: -20px; 
		background-color: #4B0082;
		color: white;
		width: 20px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 0 5px 5px 0;
		cursor: pointer;
		font-weight: bold;
		transition: transform 0.3s ease;
	}
	.sidebar.hidden {
		transform: translateX(-100%);
	}
	.sidebar.hidden .sidebar-toggle {
		transform: rotate(180deg);
	}
</style>

<div class="sidebar">
    <div class="sidebar-header">
        <h2 class="sidebar-title">ADMIN</h2>
		<div id="sidebarToggle" class="sidebar-toggle">â—€</div>
    </div>
    <ul class="sidebar-nav">
        <li class="nav-item"><a href="/admin" class="nav-link">User Management</a></li>
        <li class="nav-item"><a href="/student" class="nav-link">Student Management</a></li>
        <li class="nav-item"><a href="/attendance" class="nav-link">View Attendance</a></li>
        <li class="nav-item logout"><a href="/logout" class="nav-link">Logout</a></li>
    </ul>
</div>

<main>
    <h1>View Attendance</h1>
    <div class="date-filter">
        <label for="date-select">SELECT DATE</label>
        <input type="date" id="date-select">
        <button id="go-btn">GO</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>IDNO</th>
                    <th>Lastname</th>
                    <th>Firstname</th>
                    <th>Course Level</th>
                    <th>Time-in</th>
                </tr>
            </thead>
            <tbody id="attendance-body"></tbody>
        </table>
        <div class="no-data">No attendance data available for the selected date.</div>
    </div>
</main>

<script>
function loadAttendance(date=null) {
    if (!date) {
        const today = new Date();
        date = today.toISOString().split('T')[0]; // format YYYY-MM-DD
        document.getElementById("date-select").value = date;
    }

    fetch(`/attendance_update?date=${date}`)
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById("attendance-body");
            tbody.innerHTML = "";

            const noDataDiv = document.querySelector(".no-data");
            if (data.length === 0) {
                noDataDiv.style.display = "flex";
            } else {
                noDataDiv.style.display = "none";
            }

            data.forEach((record, index) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.idno}</td>
                    <td>${record.lastname}</td>
                    <td>${record.firstname}</td>
                    <td>${record.course} ${record.level}</td>
                    <td>${record.time_in}</td>
                `;
                tbody.appendChild(tr);
            });
        });
}
	window.addEventListener("DOMContentLoaded", () => loadAttendance());

	document.getElementById("date-select").addEventListener("change", e => loadAttendance(e.target.value));
	document.getElementById("go-btn").addEventListener("click", () => {
		const date = document.getElementById("date-select").value;
		loadAttendance(date);
	});
	const sidebar = document.querySelector('.sidebar');
	const toggle = document.getElementById('sidebarToggle');
	const mainContent = document.querySelector('.main-content');

	toggle.addEventListener('click', (e) => {
		e.stopPropagation();
		sidebar.classList.toggle('hidden');
		mainContent.classList.toggle('shifted');
	});
</script>
{% endblock %}
